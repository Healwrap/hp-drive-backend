# 网盘系统后端

## 1.需求分析

该网盘主要是仿照百度网盘之类的网盘应用

**网盘基础功能**包含**文件管理、上传文件、下载文件、分享文件及管理、回收站**等最基础功能

1. 文件管理包含**获取总容量和剩余容量、获取文件列表树（分级加载目录）、新增文件夹、重命名文件/文件夹、删除文件（放入回收站）**
2. 上传文件包含**大文件分片上传、相同md5文件秒传、文件夹上传、上传限速、上传队列功能**
3. 下载文件包含**文件夹打包为压缩包下载、下载限速功能**（因为是Web应用，所以下载的作用仅仅是提供一个下载链接，不过可以限制下载速度）

4. 分享文件包含**设置有效期、设置提取码功能**、管理分享的文件或文件夹**包含复制链接和取消分享**

5. 删除文件首先放入回收站，在回收站可以**彻底删除文件或者恢复文件**

**后台管理**包含**数据图表大屏、用户管理（增删改查）、管理用户文件、管理空间等**

拓展功能包含增加**AI功能（简单问答、智能搜索）、客户端预览多种文件类型的功能、隐藏空间（二级密码，刚好使用SaToken）功能**

分析功能之后，得出几个表：**用户表、管理员表、文件表、文件分块信息表、文件分享表、文件回收站表、设置表**

- 用户表
  - ID（雪花自增，以下ID均为雪花自增）
  - 用户名（唯一键）
  - 密码
  - 昵称
  - 头像链接
  - 其他通讯信息（邮箱、手机号等等可选）
  - 创建时间
  - 修改时间
  - 状态（禁用）
  - 逻辑删除
- 管理员表
  - ID
  - 用户名
  - 密码
  - 头像链接
  - 逻辑删除
- 文件表
  - ID
  - 用户ID
  - 文件名
  - 文件路径
  - 描述（使用AI识别生成简介）
  - 父级ID（用于建立文件树形结构）
  - 类型（是文件还是文件夹）
  - 后缀（针对文件）
  - MD5（针对文件，可以在此基础上增加相同文件不上传的特性）
  - 存储类型（服务器本地存储或者OSS服务**待定**）
  - 大小（字节）
  - 状态（正常0、放入回收站1）
  - 修改时间
  - 创建时间
  - 不要逻辑删除
- 文件分块信息表（**注意这是本地表**，分块信息保存在本地，分块本地合成后上传OSS）
  - ID
  - 父级文件夹ID
  - 用户ID（针对用户的上传分块）
  - 文件名
  - 文件后缀
  - 文件路径
  - 分块ids（chunkIds）
  - 还需要上传的ids（needs）
- 文件分享表
  - ID
  - 文件ID
  - 用户ID
  - 分享时间
  - 有效时间（一天、七天、永久 -1，时间使用秒表示）
  - 分享码
  - 创建时间
  - 修改时间
  - 不要逻辑删除
- 文件回收站表
  - ID
  - 文件ID
  - 用户ID
  - 创建时间
  - 不要逻辑删除
- 设置表
  - ID
  - 用户ID
  - 存储空间大小（默认 100M，使用字节单位）
  - 上传速度（字节/s，默认0即为不限速）
  - 下载速度（字节/s，默认0即为不限速）
  - 其他设置（待定）
- 隐藏空间表（待定，表设计基本和回收站表差不多）

根据文字描述创建MySQL表



技术选型

- 后端：基础模板（SpringBoot、SaToken）、鉴权使用jwt(cookie在其他平台上可能不生效如安卓)、文件存储考虑本地和OSS服务两种
- 前端：拓展React技术栈，使用React 18 + Zustand + MUI + Taiwind CSS + Vite，文件上传部分抽离成单独的部分，作为一个npm包
- AI：使用通义或者豆包API，在客户端使用SSE流式输出对话结果





